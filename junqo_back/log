
> junqo_back@0.0.1 test:e2e
> DOTENV_CONFIG_PATH=.env.test jest --config ./test/jest-e2e.json

  console.log
    Creating test environment with app port: 15490, db port: 22904

      at createTestingEnvironment (test-setup.ts:60:11)

  console.log
    Creating test environment with app port: 13014, db port: 27783

      at createTestingEnvironment (test-setup.ts:60:11)

  console.log
    Creating test environment with app port: 10085, db port: 21188

      at createTestingEnvironment (test-setup.ts:60:11)

  console.log
    Creating test environment with app port: 19364, db port: 27376

      at createTestingEnvironment (test-setup.ts:60:11)

  console.log
    Creating test environment with app port: 10696, db port: 29612

      at createTestingEnvironment (test-setup.ts:60:11)

  console.log
    Creating test environment with app port: 14180, db port: 22270

      at createTestingEnvironment (test-setup.ts:60:11)

  console.log
    Database container started: junqo_db_test_1779b5ce

      at createTestingEnvironment (test-setup.ts:104:13)

  console.log
    Database container started: junqo_db_test_3ad29bc1

      at createTestingEnvironment (test-setup.ts:104:13)

  console.log
    Database container started: junqo_db_test_5abcc076

      at createTestingEnvironment (test-setup.ts:104:13)

  console.log
    Database container started: junqo_db_test_f3fcacad

      at createTestingEnvironment (test-setup.ts:104:13)

  console.log
    Database container started: junqo_db_test_6d25d984

      at createTestingEnvironment (test-setup.ts:104:13)

  console.log
    Database container started: junqo_db_test_793d0e47

      at createTestingEnvironment (test-setup.ts:104:13)

  console.log
    query is {"skills":["JavaScript"]}

      at StudentProfilesController.findByQuery (../src/student-profiles/student-profiles.controller.ts:18:13)

  console.log
    query is {"skills":["Python","Django"]}

      at StudentProfilesController.findByQuery (../src/student-profiles/student-profiles.controller.ts:18:13)

PASS test/app.e2e-spec.ts (18.748 s)
  App E2E Tests
    ✓ hello (51 ms)

PASS test/studentProfiles.e2e-spec.ts (19.295 s)
  Student Profiles E2E Tests
    Permission Tests
      ✓ should allow company users to view student profiles (39 ms)
      ✓ should allow admin users to view student profiles (10 ms)
      ✓ should prevent student users from reading other student profiles (10 ms)
    Query Student Profiles
      ✓ should get student profile by ID (9 ms)
      ✓ should throw not found error for non-existent student profile ID (12 ms)
      ✓ should get current student profile with my endpoint (12 ms)
      ✓ should query students by skills (28 ms)
    Update Student Profile
      ✓ should update student profile (38 ms)
      ✓ should validate student profile data (9 ms)

FAIL test/users.e2e-spec.ts (19.615 s)
  Users E2E Tests
    Query Users
      ✓ should get current user profile when authenticated (44 ms)
      ✓ should not allow access to user profile without authentication (5 ms)
    Update User
      ✓ should update user profile details (38 ms)
      ✓ should validate email format when updating profile (7 ms)
      ✓ should validate name format when updating profile (7 ms)
      ✓ should update user password (153 ms)
    Delete User
      ✕ should allow users to delete their own account (184 ms)

  ● Users E2E Tests › Delete User › should allow users to delete their own account

    expected 200 "OK", got 404 "Not Found"

      208 |         .delete(`${baseRoute}/me`)
      209 |         .set('Authorization', `Bearer ${tempUserToken}`)
    > 210 |         .expect(HttpStatus.OK);
          |          ^
      211 |
      212 |       expect(response.body.isSuccessful).toBe(true);
      213 |

      at Object.<anonymous> (users.e2e-spec.ts:210:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:267:14)
      at ../node_modules/supertest/lib/test.js:323:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:300:13)
      at Test.assert (../node_modules/supertest/lib/test.js:179:23)
      at localAssert (../node_modules/supertest/lib/test.js:135:14)
      at ../node_modules/supertest/lib/test.js:140:7
      at Test.fn [as callback] (../node_modules/superagent/src/node/index.js:899:3)
      at callback (../node_modules/superagent/src/node/index.js:1165:18)
      at IncomingMessage.fn (../node_modules/superagent/src/node/parsers/json.js:19:7)

PASS test/experiences.e2e-spec.ts (19.673 s)
  Experiences E2E Tests
    Experience Management
      ✓ should add experience to student profile (82 ms)
      ✓ should get all experiences for current user (26 ms)
      ✓ should update an experience (47 ms)
      ✓ should delete an experience (42 ms)

FAIL test/offers.e2e-spec.ts (19.771 s)
  Offers E2E Tests
    Query Offers
      ✓ should get all offers (62 ms)
      ✓ should get offer by ID (15 ms)
      ✓ should throw not found error for non-existent offer ID (10 ms)
    Create Offer
      ✓ should create a new offer as company (27 ms)
      ✓ should prevent students from creating offers (12 ms)
      ✓ should validate offer data (19 ms)
    Update Offer
      ✓ should update an offer as the company who created it (42 ms)
      ✓ should allow admins to update any offer (30 ms)
      ✓ should prevent students from updating offers (17 ms)
      ✓ should validate update data (23 ms)
    Delete Offer
      ✕ should delete an offer as the company who created it (55 ms)
      ✕ should allow admin to delete any offer (30 ms)
      ✓ should prevent students from deleting offers (26 ms)
      ✓ should return error for non-existent offer ID (18 ms)
    Company Offers Management
      ✓ should get company's own offers (7 ms)
    Application Features
      ✕ should get applied offers for a student (126 ms)
      ✓ should allow a student to apply to an offer (6 ms)
      ✓ should allow a student to withdraw application from an offer (9 ms)

  ● Offers E2E Tests › Delete Offer › should delete an offer as the company who created it

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: {}

      328 |         .expect(HttpStatus.OK);
      329 |
    > 330 |       expect(response.body).toBe(true);
          |                             ^
      331 |
      332 |       // Verify the offer is deleted
      333 |       await request(testEnv.app.getHttpServer())

      at Object.<anonymous> (offers.e2e-spec.ts:330:29)

  ● Offers E2E Tests › Delete Offer › should allow admin to delete any offer

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: {}

      343 |         .expect(HttpStatus.OK);
      344 |
    > 345 |       expect(response.body).toBe(true);
          |                             ^
      346 |     });
      347 |
      348 |     it('should prevent students from deleting offers', async () => {

      at Object.<anonymous> (offers.e2e-spec.ts:345:29)

  ● Offers E2E Tests › Application Features › should get applied offers for a student

    expected 501 "Not Implemented", got 500 "Internal Server Error"

      375 |         .get(`${baseRoute}/applied`)
      376 |         .set('Authorization', `Bearer ${studentToken}`)
    > 377 |         .expect(HttpStatus.NOT_IMPLEMENTED);
          |          ^
      378 |     });
      379 |
      380 |     it('should allow a student to apply to an offer', async () => {

      at Object.<anonymous> (offers.e2e-spec.ts:377:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:267:14)
      at ../node_modules/supertest/lib/test.js:323:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:300:13)
      at Test.assert (../node_modules/supertest/lib/test.js:179:23)
      at localAssert (../node_modules/supertest/lib/test.js:135:14)
      at ../node_modules/supertest/lib/test.js:140:7
      at Test.fn [as callback] (../node_modules/superagent/src/node/index.js:899:3)
      at callback (../node_modules/superagent/src/node/index.js:1165:18)
      at IncomingMessage.fn (../node_modules/superagent/src/node/parsers/json.js:19:7)

PASS test/auth.e2e-spec.ts (21.494 s)
  Auth E2E Tests
    Sign Up
      ✓ SignUp User (501 ms)
      ✓ SignUp with invalid email format (313 ms)
      ✓ SignUp with duplicate email (509 ms)
      ✓ SignUp with invalid password (348 ms)
      ✓ SignUp with invalid user type (195 ms)
    Sign In
      ✓ SignIn User (311 ms)
      ✓ SignIn with invalid email (145 ms)
      ✓ SignIn with invalid password (191 ms)
    IsLoggedIn
      ✓ IsLoggedIn with valid token should return true (129 ms)
      ✓ IsLoggedIn without token should return false (130 ms)
      ✓ IsLoggedIn with invalid token should return false (144 ms)

Test Suites: 2 failed, 4 passed, 6 total
Tests:       4 failed, 46 passed, 50 total
Snapshots:   0 total
Time:        22.49 s
Ran all test suites.
